# HTTP协议那些事

## http请求模型
### 客户端，服务器
* Client -> 请求(request) -> Server
* Server -> 响应(response) -> Client
* 不会影响数据，除非劫持

## 浏览器行为与http协议
### 处理过程
1. 输入网址并回车
2. 解析域名
3. 浏览器发送http请求
4. 服务器处理请求
5. 服务器返回html响应
6. 浏览器处理html页面
7. 继续请求其他资源

### 处理流程2
1. 浏览器接收到请求

2. 局域网通过防火墙（控制数据包进出的设备，网络边界）和路由器或者是代理服务器等设备走通外网
> 防火墙
>> 防火墙有软和硬，硬件防火墙相当于一辆高配宝马
>> 防火墙就是一个对数据包的一个发送和接收的策略，什么样的包可以出，什么样的包可以进，专门管策略的一层壳，调用linux内核的网络功能（linux六大系统之一的网络子系统的核心功能）
> 路由器功能
>> 家用路由，负责和电信那边的tcp服务器进行联系（硬件链路）

3. DNS解析（域名解析）
> dns的IP地址实际上是内置到电脑里面的，只要计算机获取到ip地址，同时也会把dns服务器的IP地址获取到
> 路由器是网络上的透明路由器
> 如何获取到路由器(不能加协议) => centos
>> `traceroute www.baidu.com`
>> centos下如果出现-bash: traceroute: 未找到命令，要先安装
`yum install traceroute -y`
>> 如果不能探查到的用出现* * * 
>> 因为在使用traceroute的时候，实际上是发送ping包<br />
ping包中icmp_seq指包的数列号（链路层协议），ttl是指计数器（window默认大小是52），每经过一个路由ttl会减1，一直减到0，这个包会被路由器扔掉，意味着，这个包在网络上传输的时间太久了，陷入了一个死循环(ttl默认值-当前ttl为跨过的路由器数量)
>>> windows下是
`tracert www.baidu.com`

4. tcp/ip协议链路问题

5. 到http服务器机房，一棵树（集群），树上鸟就是服务器，这棵树只有一个出入口（ip地址），请求进去了，还会有一个反向代理，根据你请求头上的东西，决定分发到哪只鸟（服务器）上去

6. 到了一只鸟（服务）上，服务器要做出反应（响应），数据再回去（和来的路不一样），浏览器收到数据，浏览器处理数据（性能优化[缓存，dom解析，渲染，脚本和事件的绑定等等]）


## 什么是http
* http是超文本传输协议，从www浏览器传输到本地浏览器的一种传输协议
* http协议是由客户端到服务器的请求（request）和从服务器到客户机的响应（response）进行约束和规范

## TCP/IP协议栈（iso/osi协议）
1. 应用层
	* 应用层，表示层，会话层
> 为用户提供所需的各种服务（http,ftp,dns,smtp,ssh....）直接和应用程序打交道
2. 传输层
> 为应用层实体提供端对端的通信功能，保证数据包的顺序传送及数据的完整性
> 该层定义了两个主要的协议：传输控制协议（TCP）和用户数据报协议（UDP）
3. 网络层
> 主要解决主机到主机的通信问题，ip协议是网络互联网最重要的协议
>> ping,traceroute(tracert)
4. 网络接口层
	* 数据链路层，物理层(网卡，路由器)
> 负责监视数据在主机和网络之间的交换

## TCP/IP协议栈中的位置
* 目前普遍应用版本HTTP 1.1
* 正在逐步向HTTP 2 迁徙
* HTTP默认端口80
* HTTPS默认端口443
>> https就是在http中加了一块加密模块（TLS、SSL）

## HTTP的工作过程(重点)
* 一次HTTP操作成为一个__事务__，其工作过程可分为四步
> 事务：一个操作假如有若干个有序操作，必须严格按照顺序操作，只要其中任何一个过程或者顺序出了错误，就算所有的操作执行失败，假如这个操作有这样的性质，就是事务
1. 首先客户机与服务器需要建立连接。只要单击某个超链接（TCP），http工作开始。
2. 建立连接后，客户机发送一个请求给服务器，请求方式的格式为：统一资源标识符（url）、协议版本号，后面是MIME信息包括请求修饰符、客户机信息和可能的内容。
3. 服务器接收到请求后，给予相应的相应信息，其格式为一个状态行，包括信息的协议版本号、一个成功或错误的代码，后面是MIME信息包括服务器信息，实体信息和可能的内容
4. 客户端接收服务器所返回的信息通过浏览器显示在用户的显示屏上，然后客户机与服务器断开连接（TCP连接）
> * 如果以上过程中的某一步出现错误，那么产生的错误信息将返回到客户端，有显示屏输出。对于用户来说，这些过程是由HTTP自己完成的，用户只要用鼠标点击，等待信息显示就可以了

## 请求与响应
* HTTP请求组成：请求行、消息报头、请求正文
* HTTP响应组成：状态行、消息报头、响应正文
* 请求行组成：以一个方法符号开头，后面跟着请求的URI和协议的版本
* 状态行组成：服务器HTTP协议的版本，服务器发挥的响应状态代码和状态代码的文本描述

## 请求方法（8个）
* get/post/put/delete(增删改查最重要)
* GET：请求获取request-uri所标识的资源
* POST：在request-uri所标识的资源后附加新的数据
* HEAD：请求获取由request-uri所标识的资源的响应消息报头
* PUT：请求服务器存储一个资源，并用request-uri作为其标识
* DELETE：请求服务器删除request-uri所标识的资源
* TRACE：请求服务器回送收到的请求信息，主要用于测试或诊断
* CONNECT：HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器
* OPTIONS：请求查询服务器性能，或者查询与资源相关的选项和需求

## HTTP状态码
__状态码有三位数字组成，第一个数字定义了响应的类别__
* 1xx：指示信息--表示请求已接收，继续处理
* 2xx：成功--表示请求已被成功接收、理解、接受
* 3xx：重定向--要完成请求必须进行更进一步操作
* 4xx：客户端错误--请求有语法错误或请求无法实现
* 5xx：服务器端错误--服务器未能实现合法的请求

## HTTP2协议分析


## cookie和session
### cookie
1. 概念： Cookie是保存在客户端的小段文本，随客户端每一个请求发送该url下的所有cookies到服务器端
- ASCII码
- 人是客户端，小区是服务器，门卫是防火墙，门禁卡就是cookie，cookie里面包含了识别你身份的信息 。小区必须有门禁卡的id(数据库) 。

2. cookie的使用
- 与cookie相关的http扩展头
	1. cookie:客户端将服务器设置的cookie返回到服务器
	2. set-cookie：服务器向客户端设置cookie
	3. 服务器在响应消息中用set-cookie头将cookie的内容回送给客户端，客户端在新的请求中将相同的内容携带在Cookie头中发送给服务器，从而实现会话的保持。

### session
1. 概念： Session则保存在服务器端，通过唯一的值sessionID来区别每一个用户，sessionID随每个连接请求发送到服务器，服务器根据sessionID来识别客户端，再通过session的key获取session值
- 理解成数据库，用来维持会话
- http是无状态（连接状态）协议
- session就是处于服务器上的数据结构

2. session的使用
- 使用cookie来实现
- 使用url回显来实现


## http缓存机制
### 1. 概念
缓存会根据请求保存输出内容的副本，例如html页面，图片，文件，当下一个请求来到的时候：如果是相同的url，缓存直接只用副本响应访问请求，而不是向源服务器再次发送请求

### 2. 过程：
1. 第一次请求，没有缓存，服务器向客户端响应，数据存在硬盘上
2. 第二次请求，服务器向客户端做一次缓存协商（检查本地有没有缓存，是否有过期），如果有缓存且没过期，就返回一个304跳转（意味着不在响应体）

### 3. 缓存的优点
1. 减少相应的延迟
2. 减少网络带宽的消耗

## 了解两种缓存策略
### 1. 缓存
1. 强制缓存：
- 服务器通知浏览器一个缓存时间，在缓存时间内，下次请求，直接用缓存，不在时间内，执行比较缓存策略

2. 比较缓存
- 将缓存信息中的Eag和Last-Modified通过请求发送给服务器，由服务器校验，返回304状态码时，浏览器直接使用缓存

### 2.策略
1. Etag/if-None-Match策略
2. Last-Modified/if-Modified-Since策略

## Https协议分析
### 1. https概念
Https协议的安全性由SSL协议（加密协议）实现，当前使用的TLS协议1.2版本包含了四个核心自协议：握手协议、秘钥配置切换协议、应用数据协议、报警协议

### 2. 数字证书
1. 概念：数字证书是互联网通信中标识双方身份信息的数字文件，由CA签发
2. tip:
- 数字证书世界上是一种安全领域的方案
- 数字证书不能简单归结于加密，但他本身使用了加密技术
- 数字证书是用来识别身份的

### 3. CA
1. 概念：CA（certification authority）是数字证书的签发机构，作为权威机构，其审核申请者身份后签发数字证书，这样我们只需要校验数字证书即可确定对方的真实身份

### 4. HTTPS、SSL、TSL、握手协议的关系
1. HTTPS
- HTTPS是Hypertext Transfer Protocol over Secure Socket Layer的缩写，即HTTP over SSL，可理解为基于SSL的HTTP协议。HTTP协安全是由SSL协议实现的
2. SSL
- SSL协议是一种记录协议，扩展性良好，可以很方便的添加子协议，而握手协议便是SSL协议中的一个子协议
> 可以看出一个目录，新加的特性放在这里面描述
3. TSL
- TSL协议是SSL协议的后续版本，本文中涉及的SSL协议默认是TSL协议的1.2版本
> TSL的核心是一些加密的算法和方案
> 现在使用比较广泛的大部分加密算法来源于SSL库（开源的是open SSL）加密使用开源不专业


## Http2协议分析
### 1. 优点
- 使用二进制格式传输，更高效，更紧凑
- 对报头压缩，降低开销
- 多路复用，一个网络连接实现并行请求。
- 服务器主动推送，减少请求的延迟
- 默认使用加密

### 2.特点
- 有伪头，前面有冒号（协议头），经过协商之后的第二次发送请求